name: CI

on:
 push:
  branches:
   - '**'
 pull_request:
  branches:
   - '**'

jobs:
 full-suite:
  strategy:
   fail-fast: false
   matrix:
    os: [ubuntu-latest, windows-latest, macos-latest]
  runs-on: ${{ matrix.os }}
  steps:
   - name: Checkout
     uses: actions/checkout@v4

   - name: Setup Bun
     uses: oven-sh/setup-bun@v2
     with:
      bun-version: 1.2.21

   - name: Install dependencies
     run: bun install --frozen-lockfile

   - name: Main Validation Gate
     run: |
      bun run typecheck
      bun run lint
      bun run check:boundaries
      bun run test
      bun run test:provider
      bun run check:migrations
      bun run test:migration
      bun run test:integration:stable
      bun run test:smoke
